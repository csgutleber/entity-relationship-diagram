<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Entity Relationship Diagram demo</title>
    <link rel="stylesheet" type="text/css" href="erdiagram.css" />
    <script src="erdiagram.js" defer="defer"></script>

    <script defer="defer">
        function getSimpleSetup() {
            let city = new Entity({
                name: "City",
                properties: [
                    { name: "id", type: "int" },
                    { name: "name", type: "string" },
                ]
            });
            let address = new Entity({
                name: "Address",
                properties: [
                    { name: "id", type: "bigint" },
                    { name: "zip", type: "decimal(4)" },
                    { name: "city_id", type: "int" },
                    { name: "street", type: "string" },
                    { name: "number", type: "decimal" },
                ]
            });
            let person = new Entity({
                name: "Person",
                properties: [
                    { name: "id", type: "bigint" },
                    { name: "family_name", type: "string" },
                    { name: "given_name", type: "string" },
                    { name: "perm_address_id", type: "bigint" },
                    { name: "temp_address_id", type: "bigint" },
                    { name: "manager_id", type: "bigint" },
                ]
            });

            const entities = [city, address, person];
            const relationships = [];
            relationships.push(new EntityRelationship(address.property("city_id"), city.property("id")));
            relationships.push(new EntityRelationship(person.property("perm_address_id"), address.property("id")));
            relationships.push(new EntityRelationship(person.property("temp_address_id"), address.property("id")));
            relationships.push(new EntityRelationship(person.property("manager_id"), person.property("id")));

            return { entities, relationships };
        }

        function getComplexSetup() {
            const entities = [];
            for (let i = 0; i < 20; ++i) {
                let entity = new Entity({
                    name: "entity" + i,
                    properties: [
                        { name: "a", type: "T1" },
                        { name: "b", type: "T2" },
                        { name: "c", type: "T3" }
                    ]
                });
                entities.push(entity);
            }

            const relationships = [];
            for (let i = 0; i < 20; ++i) {
                for (let j = 0; j < 20; ++j) {
                    if (Math.random() > 0.9) {
                        relationships.push(new EntityRelationship(entities[i].property("a"), entities[j].property("b")));
                    }
                }
            }

            return { entities, relationships };
        }

        function displayElasticDiagram(setup) {
            let { entities, relationships } = setup();
            diagram = new ElasticEntityDiagram(document.getElementById("elastic-diagram"), entities, relationships);
            diagram.layout({
                charge: 1000,
                stiffness: 0.2,
                drag: 0.5,
                gravity: 2.0,
                iterations: 500,
            });
        }

        function displayNavigableDiagram(setup) {
            let { entities, relationships } = setup();
            diagram = new NavigableEntityDiagram(document.getElementById("navigable-diagram"), entities, relationships);
        }

        document.addEventListener("DOMContentLoaded", () => {
            const setup = getComplexSetup;

            //console.log(new EntityGraph(relationships).shortestPath(entities[2], entities[0]));

            displayElasticDiagram(setup);
            displayNavigableDiagram(setup);
            new TabView(document.getElementById("tab-panel"));
        });
    </script>
</head>

<body>
    <div id="tab-panel" class="tab-panel">
        <div class="tab-selector">
            <span data-tab="elastic">Elastic</span>
            <span data-tab="navigator">Navigator</span>
            <span data-tab="path">Shortest path</span>
        </div>
        <div class="tab-view">
            <div id="elastic-diagram" class="diagram tab-active" data-tab="elastic"></div>

            <div id="navigable-diagram" class="diagram" data-tab="navigator">
                <div class="navigator">
                    <div class="left"></div>
                    <div class="center">
                        <select></select>
                    </div>
                    <div class="right"></div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
