<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Entity Relationship Diagram demo</title>
    <link rel="stylesheet" type="text/css" href="erdiagram.css" />
    <script src="erdiagram.js" defer="defer"></script>

    <script defer="defer">
        function getSimpleSetup(entities, relationships) {
            let city = new Entity({
                name: "City",
                properties: [
                    { name: "id", type: "int" },
                    { name: "name", type: "string" },
                ]
            });
            let address = new Entity({
                name: "Address",
                properties: [
                    { name: "id", type: "bigint" },
                    { name: "zip", type: "decimal(4)" },
                    { name: "city_id", type: "int" },
                    { name: "street", type: "string" },
                    { name: "number", type: "decimal" },
                ]
            });
            let person = new Entity({
                name: "Person",
                properties: [
                    { name: "id", type: "bigint" },
                    { name: "family_name", type: "string" },
                    { name: "given_name", type: "string" },
                    { name: "perm_address_id", type: "bigint" },
                    { name: "temp_address_id", type: "bigint" },
                    { name: "manager_id", type: "bigint" },
                ]
            });

            entities.push(city, address, person);
            relationships.push(new EntityRelationship(address.property("city_id"), city.property("id")));
            relationships.push(new EntityRelationship(person.property("perm_address_id"), address.property("id")));
            relationships.push(new EntityRelationship(person.property("temp_address_id"), address.property("id")));
            relationships.push(new EntityRelationship(person.property("manager_id"), person.property("id")));
        }

        function getComplexSetup(entities, relationships) {
            for (let i = 0; i < 20; ++i) {
                let entity = new Entity({
                    name: "entity" + i,
                    properties: [
                        { name: "a", type: "T1" },
                        { name: "b", type: "T2" },
                        { name: "c", type: "T3" }
                    ]
                });
                entities.push(entity);
            }

            for (let i = 0; i < 20; ++i) {
                for (let j = 0; j < 20; ++j) {
                    if (Math.random() > 0.9) {
                        relationships.push(new EntityRelationship(entities[i].property("a"), entities[j].property("b")));
                    }
                }
            }
        }

        function displayElasticDiagram(entities, relationships) {
            diagram = new ElasticEntityDiagram(document.getElementById("elastic-diagram"), entities, relationships);
            diagram.layout({
                charge: 1000,
                stiffness: 0.2,
                drag: 0.5,
                gravity: 2.0,
                iterations: 500,
            });
        }

        function displayNavigableDiagram(entities, relationships) {
            diagram = new NavigableEntityDiagram(document.getElementById("navigable-diagram"), entities, relationships);
            diagram.show(entities[2]);
        }

        document.addEventListener("DOMContentLoaded", () => {
            let entities = [];
            let relationships = [];
            getComplexSetup(entities, relationships);

            displayElasticDiagram(entities, relationships);
            //displayNavigableDiagram(entities, relationships);
        });
    </script>
</head>

<body>
    <div id="elastic-diagram" class="diagram"
        style="border: thin black solid; box-sizing: border-box; width: 90vw; height: 90vh;">
    </div>

    <!--
    <div id="navigable-diagram" class="diagram"
        style="border: thin black solid; box-sizing: border-box; width: 90vw; height: 90vh;">
        <div class="navigator">
            <div class="left"></div>
            <div class="center">
                <select></select>
            </div>
            <div class="right"></div>
        </div>
    </div>
    -->
</body>

</html>
